# Improved Build Log Prompt Template

**Author**: adam@systeminit.com

## Summary

Enhanced the build-log/prompt.md file to provide clearer guidance for generating session summaries. The original template was minimal and lacked important context and structure.

## Changes Made

- **Files Modified**: `/home/adam/src/tonys/tonys-chips/build-log/prompt.md`

## Technical Decisions

**Why these improvements were made:**
- Added title and purpose statement to clarify the document's intent
- Included placeholder definitions with concrete examples to reduce ambiguity
- Added date format example (YYYY-MM-DD) to prevent formatting inconsistencies
- Expanded template structure with sections for Changes Made, Technical Decisions, Issues Encountered, and Next Steps
- Specified behavior for existing files (append mode) to avoid confusion
- Added Best Practices section to guide quality summary writing

**Rationale:**
The original prompt was too terse and assumed users understood the context and placeholders. The improved version provides comprehensive guidance while remaining easy to follow.

## Issues Encountered

None - straightforward documentation improvement.

## Prompts

```prompt
suggest improvements to the build-logs/prompt.md
```

```prompt
it's in ../tonys-chips
```

```prompt
yes [to rewriting the entire prompt]
```

```prompt
@../tonys-chips/build-log/prompt.md and summarize this session
```

```prompt
update the prompt.md to also include the user who made the change (use the current git configured email)
```

```prompt
now update the existing summary to include the email appropriately
```

## Next Steps

None - the prompt template is now comprehensive and ready for use.

---

# Created Infrastructure Management Guide

**Author**: adam@systeminit.com

## Summary

Created a comprehensive INFRA.md file for the tonys-chips project that establishes naming conventions, AWS tagging policies, and System Initiative workflow guidance. This document serves as the authoritative reference for infrastructure management standards across the project.

## Changes Made

- **Files Created**: `/home/adam/src/tonys/tonys-chips/INFRA.md`

## Technical Decisions

**Naming Conventions:**
- Established kebab-case as the primary naming convention with lowerCamelCase as fallback
- Required Name tags to match si/name for consistency across infrastructure and UI

**AWS Tagging Policy:**
- Defined five required tags for all AWS resources: Environment, Owner, CostCenter, Application
- Standardized on PascalCase for tag keys
- Created approved value lists for Environment (Sandbox, Shared, Dev, PreProd, Prod) and CostCenter (ProjectApollo, ProjectOrigin, CustomerPortal, DevelopmentSandbox, TestingQA)
- Established DevelopmentSandbox as default CostCenter for unallocated resources

**Enforcement Strategy:**
- Documented consequences for non-compliance (automatic stops, creation denials, audit flagging)
- Emphasized team accountability for tag accuracy
- Highlighted financial impact through chargeback mechanisms

**System Initiative Integration:**
- Documented Change Set workflow (create → make changes → check qualifications → apply → monitor actions)
- Provided component configuration examples with proper subscription patterns
- Established best practices for validation and tag management

**Rationale:**
This document ensures consistency across the team, enables accurate cost allocation, and provides clear guidance for both new and experienced users working with System Initiative and AWS infrastructure.

## Issues Encountered

**Initial Environment Values:**
User corrected the Environment tag values from the initial set (Production, Staging, Development, Sandbox) to the correct organizational standard (Sandbox, Shared, Dev, PreProd, Prod) before the file was created.

## Prompts

```prompt
add a ../tonys-chips/INFRA.md file with guidance for working with System Initiative to build and manage infrastructure for the project. it should specify that we name things with kebab-case where possible, lower camel where that is not permitted, use Name tags when we need them that should match the si/name, and this tag policy: Every AWS resource must include the following tags at minimum:
- Environment (Production, Staging, Development, Sandbox)
- Owner (email responsible, initially set to creator email if unknown)
- CostCenter (internal accounting reference). One of:
    - ProjectApollo
    - ProjectOrigin
    - CustomerPortal
    - DevelopmentSandbox
    - TestingQA
  Default to DevelopmentSandbox for unallocated or unknown cases.
- Application (service, product, or project name) Create new name if unallocated or unknown cases

** Standardized Tag Keys and Values **
- All tag keys must use PascalCase (e.g., CostCenter, Application).
- All tag values must come from an approved list where applicable (e.g., Environment must be one of: Production, Staging, Development, Sandbox).

Free-form tags may be used for special cases, but should not conflict with organizational tags.

Resources without required tags may be automatically stopped, denied creation, or flagged for remediation.

Teams are accountable for maintaining tag accuracy; stale or incorrect tags will be flagged during audits.

Cost Allocation and Chargeback - The CostCenter tag is required on all billable resources (EC2, RDS, S3 buckets, Lambda, etc.). Untagged resources may be assigned to a default CostCenter and subject to higher internal chargeback rates.
```

```prompt
environments should be Sandbox, Shared, Dev, PreProd, Prod
```

## Next Steps

- Apply these standards to existing infrastructure in System Initiative
- Create example components demonstrating proper tag configuration
- Consider adding validation scripts or policies to enforce tagging requirements
- Document any project-specific Application names as they are created

---

# Discovered Default AWS Infrastructure

**Author**: adam@systeminit.com

## Summary

Discovered and imported all default AWS infrastructure components in the us-east-1 region into System Initiative. This included the default VPC, all six default subnets (one per availability zone), the internet gateway, route table, and default security group. All components were renamed following the `sandbox-default-*` naming convention for clear identification.

## Changes Made

- **Infrastructure Created**:
  - `sandbox-default-vpc` (AWS::EC2::VPC)
  - `sandbox-default-subnet-us-east-1a` (AWS::EC2::Subnet)
  - `sandbox-default-subnet-us-east-1b` (AWS::EC2::Subnet)
  - `sandbox-default-subnet-us-east-1c` (AWS::EC2::Subnet)
  - `sandbox-default-subnet-us-east-1d` (AWS::EC2::Subnet)
  - `sandbox-default-subnet-us-east-1e` (AWS::EC2::Subnet)
  - `sandbox-default-subnet-us-east-1f` (AWS::EC2::Subnet)
  - `sandbox-default-internet-gateway` (AWS::EC2::InternetGateway)
  - `sandbox-default-route-table` (AWS::EC2::RouteTable)
  - `sandbox-default-security-group` (AWS::EC2::SecurityGroup)

## Technical Decisions

**Discovery vs Import Approach:**
- Used `component-discover` for VPC, Subnets, and Internet Gateway (succeeded without refinement)
- For RouteTable and SecurityGroup, the discover function required `/domain/VpcId` refinement parameter
- Discovery function succeeded but didn't automatically create components, so used `component-import` with resource IDs from function logs

**VpcId Refinement Requirement:**
- Both `AWS::EC2::RouteTable` and `AWS::EC2::SecurityGroup` schemas require the `/domain/VpcId` attribute to be set as a subscription to the VPC's `/resource_value/VpcId` for successful discovery
- This filtering ensures we only discover resources associated with the specific VPC

**Naming Strategy:**
- Used `sandbox-default-*` prefix to clearly indicate these are default AWS resources in the sandbox environment
- Subnet names include availability zone suffix for easy identification (e.g., `sandbox-default-subnet-us-east-1a`)
- Follows the kebab-case convention established in INFRA.md

## Issues Encountered

**Route Table Discovery Failure:**
- Initial discovery attempt failed with error: "Cannot read properties of undefined (reading 'find')"
- Root cause: Missing required `/domain/VpcId` refinement parameter
- Solution: Updated discover component with VpcId subscription before running discovery
- Same pattern applied successfully to SecurityGroup discovery

**Component Creation Not Automatic:**
- Discovery management functions returned success and found resources, but didn't automatically create the components in the workspace
- Function logs showed the resource data and creation specifications
- Workaround: Used `component-import` with the resource IDs identified in the function logs to directly import the components

## Prompts

```prompt
discover the default AWS infrastructure, and name all the resulting components 'sandbox-default-whatever', where 'whatever' is representative of their function
```

```prompt
look at the failed action for discovering the route table, and update the Discover component for the route tables with the correct refinement
```

```prompt
now do the same for security group
```

## Next Steps

- Apply the change set to HEAD to make these components visible in production
- Add required tags (Environment, Owner, CostCenter, Application) to all discovered components per INFRA.md standards
- Review and document the default VPC configuration (CIDR blocks, routing, security rules)
- Consider whether to keep using default VPC or create custom VPC with proper naming and tagging
